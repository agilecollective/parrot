<VirtualHost *:<%= @apache_http_port %>>
	ServerAdmin webmaster@localhost
        ServerName <%= @name %>

	DocumentRoot /vagrant_sites/<%= @name %><%= @webroot_subdir %>
	<Directory />
		Options FollowSymLinks
		AllowOverride None
	</Directory>
	<Directory /vagrant_sites/<%= @name %><%= @webroot_subdir %>/>
		Options Indexes FollowSymLinks MultiViews
		AllowOverride All
        Require all granted
	</Directory>

	ErrorLog ${APACHE_LOG_DIR}/error.log

	# Possible values include: debug, info, notice, warn, error, crit,
	# alert, emerg.
	LogLevel warn

	CustomLog ${APACHE_LOG_DIR}/access.log combined

	ProxyPassMatch ^/(.*\.php(/.*)?)$ fcgi://127.0.0.1:9999/vagrant_sites/<%= @name %><%= @webroot_subdir %>/$1

</VirtualHost>

<IfModule mod_ssl.c>
	<VirtualHost *:<%= @apache_https_port %>>
		ServerAdmin webmaster@localhost
	        ServerName <%= @name %>

		DocumentRoot /vagrant_sites/<%= @name %><%= @webroot_subdir %>
		<Directory />
			Options FollowSymLinks
			AllowOverride None
		</Directory>
		<Directory /vagrant_sites/<%= @name %><%= @webroot_subdir %>/>
			Options Indexes FollowSymLinks MultiViews
			AllowOverride All
            Require all granted
		</Directory>

		ErrorLog ${APACHE_LOG_DIR}/error.log

		# Possible values include: debug, info, notice, warn, error, crit,
		# alert, emerg.
		LogLevel warn

		CustomLog ${APACHE_LOG_DIR}/access.log combined

		SSLEngine on
		SSLCertificateFile /etc/apache2/ssl.d/<%= @name %>.crt
        SSLCertificateKeyFile /etc/apache2/ssl.d/<%= @name %>.key

        ProxyPassMatch ^/(.*\.php(/.*)?)$ fcgi://127.0.0.1:9999/vagrant_sites/<%= @name %><%= @webroot_subdir %>/$1

	</VirtualHost>
</IfModule>
